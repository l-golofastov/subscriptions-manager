# Subscriptions Manager

REST API для управления пользовательскими подписками (создание, обновление, удаление, подсчёт суммы подписок пользователя).

Проект написан на **Go**, использует **PostgreSQL**, стандартную библиотеку `net/http`, middleware (logging, request-id, recoverer) и **Swagger** для документации API.

Требования к сервису описаны [тут](https://github.com/l-golofastov/subscriptions-manager/blob/main/ТЗ%20Junior%20GO.pdf).

---

## Технологии

- **Язык**: Go 1.25
- **База данных**: PostgreSQL 16
- **Контейнеризация**: Docker + Docker Compose

---

## Установка и запуск приложения

### Зависимости

- Docker >= 20.10
- Docker Compose >= 2.0 (plugin-based, `docker compose`)


### Клонирование репозитория

```bash
git clone https://github.com/l-golofastov/subscriptions-manager.git
cd subscriptions-manager
```

### Настройка переменных окружения

Необходимо создать файл ```.env``` и указать переменные окружения для работы приложения. 
В репозитории имеется файл [env.example](https://github.com/l-golofastov/subscriptions-manager/blob/main/env.example) в качестве примера указания необходимых переменных окружения.

Вы можете использовать переменные из примера для локального запуска:
```bash
cp env.example .env
```

Требуется указать следующие переменные окружения:
* **SERVER_ADDRESS**: Адрес сервера без порта, на котором будет запущено приложение
* **APP_PORT**: Порт приложения
* **SERVER_TIMEOUT**: Таймаут времени запроса
* **SERVER_IDLE_TIMEOUT**: Таймаут разрыва соединения с клиентом
* **POSTGRES_HOST**: Адрес для подключения к БД. Может быть полезна для доступа с хоста
* **POSTGRES_PORT**: Порт для подключения к БД. Может быть полезна для доступа с хоста
* **POSTGRES_USERNAME**: Имя пользователя БД
* **POSTGRES_PASSWORD**: Пароль пользователя БД
* **POSTGRES_DB**: Название БД

### Запуск приложения

```bash
docker compose up
```

При указании адреса сервера `localhost` и порта `8080` приложение, соответственно, будет доступно на `http://localhost:8080`.

## API

После запуска приложения Swagger-документация будет доступна по пути `/swagger`.
Например, При указании адреса сервера `localhost` и порта `8080` документация будет доступна на `http://localhost:8080/swagger`.

### Основные эндпоинты

- `POST /subscriptions` — Создание новой подписки.  
  Создаёт подписку для пользователя с указанием сервиса, цены и периода действия.

- `GET /subscriptions` — Получение списка подписок.  
  Возвращает список всех подписок, отсортированных по дате создания (по убыванию).

- `GET /subscriptions/{id}` — Получение подписки по ID.  
  Возвращает одну подписку по её UUID.

- `PATCH /subscriptions/{id}` — Обновление подписки.  
  Частичное обновление подписки (service_name, price, start_date, end_date).

- `DELETE /subscriptions/{id}` — Удаление подписки.  
  Удаляет подписку по UUID.

- `GET /subscriptions/sum` — Подсчёт суммы подписок.  
  Возвращает суммарную стоимость подписок по фильтру:
    - `user_id`
    - `service_name`
    - период (`from` / `to`)

---

### Формат дат

Во всех эндпоинтах используется кастомный формат месяца и года: MM-YYYY. 

Пример:
```json
{
  "start_date": "07-2025"
}
```
